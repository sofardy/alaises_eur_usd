# 🔄 СХЕМА ПРОЦЕССА АНАЛИЗА ДАННЫХ

```
📁 ВХОДНЫЕ ДАННЫЕ (CSV/XLSX)
│
│ Date,Time,Open,High,Low,Close,Volume
│ 2024.01.01,00:00,1.1045,1.1048,1.1042,1.1045,0
│ 2024.01.01,00:01,1.1045,1.1047,1.1043,1.1046,0
│ ... (500,000+ строк данных за год)
│
▼
┌─────────────────────────────────────────────────────────────┐
│ 🔄 ЭТАП 1: ПРЕДВАРИТЕЛЬНАЯ ОБРАБОТКА                       │
├─────────────────────────────────────────────────────────────┤
│ • Объединение Date + Time → Datetime                       │
│ • Перевод UTC+0 → UTC+3 (добавить 3 часа)                 │
│ • Оставить только: Datetime, Open, High, Low, Close        │
│ • Сортировка по времени                                     │
└─────────────────────────────────────────────────────────────┘
│
▼
┌─────────────────────────────────────────────────────────────┐
│ 📅 ЭТАП 2: РАЗДЕЛЕНИЕ ПО ДНЯМ                              │
├─────────────────────────────────────────────────────────────┤
│ • Получить уникальные даты: [2024-01-01, 2024-01-02, ...]  │
│ • Для каждой даты запустить analyze_day()                  │
└─────────────────────────────────────────────────────────────┘
│
▼
┌─────────────────────────────────────────────────────────────┐
│ 🌏 ЭТАП 3: АНАЛИЗ АЗИАТСКОЙ СЕССИИ (02:00-10:00)          │
├─────────────────────────────────────────────────────────────┤
│ • Asia High = max(High) за период 02:00-10:00              │
│ • Asia Low = min(Low) за период 02:00-10:00                │
│ • Asia Mid = (Asia High + Asia Low) / 2                     │
│ • Asia Range = Asia High - Asia Low                         │
└─────────────────────────────────────────────────────────────┘
│
▼
┌─────────────────────────────────────────────────────────────┐
│ 🏢 ЭТАП 4: ПРОВЕРКА ФРАНКФУРТ SWEEP (09:00-10:00)         │
├─────────────────────────────────────────────────────────────┤
│ • Frankfurt High = max(High) за 09:00-10:00                │
│ • Frankfurt Low = min(Low) за 09:00-10:00                  │
│ • Sweep High? Frankfurt High >= Asia High + 0.00010        │
│ • Sweep Low? Frankfurt Low <= Asia Low - 0.00010           │
└─────────────────────────────────────────────────────────────┘
│
▼
┌─────────────────────────────────────────────────────────────┐
│ 🇬🇧 ЭТАП 5: ПРОВЕРКА ЛОНДОН SWEEP (10:00-15:00)          │
├─────────────────────────────────────────────────────────────┤
│ • London High = max(High) за 10:00-15:00                   │
│ • London Low = min(Low) за 10:00-15:00                     │
│ • Sweep High? London High >= Asia High + 0.00010           │
│ • Sweep Low? London Low <= Asia Low - 0.00010              │
│ • Зафиксировать: sweep_price, sweep_time                   │
└─────────────────────────────────────────────────────────────┘
│
▼
┌─────────────────────────────────────────────────────────────┐
│ 📊 ЭТАП 6: ОПРЕДЕЛЕНИЕ НАПРАВЛЕНИЯ ЛОНДОНА                 │
├─────────────────────────────────────────────────────────────┤
│ Если есть sweep:                                            │
│ • up_move = max(High после sweep) - sweep_price             │
│ • down_move = sweep_price - min(Low после sweep)            │
│                                                             │
│ Если нет sweep:                                             │
│ • up_move = London High - London Open                       │
│ • down_move = London Open - London Low                      │
│                                                             │
│ Результат: up_move > down_move ? "Long" : "Short"           │
└─────────────────────────────────────────────────────────────┘
│
▼
┌─────────────────────────────────────────────────────────────┐
│ 🎯 ЭТАП 7: КЛАССИФИКАЦИЯ SWEEP TYPE                        │
├─────────────────────────────────────────────────────────────┤
│ ┌─────────────────┬──────────────────┬──────────────────┐   │
│ │ Пробитие        │ Направление      │ Результат        │   │
│ ├─────────────────┼──────────────────┼──────────────────┤   │
│ │ Asia High       │ Long             │ Continue         │   │
│ │ Asia High       │ Short            │ Sweep & Reverse  │   │
│ │ Asia Low        │ Short            │ Continue         │   │
│ │ Asia Low        │ Long             │ Sweep & Reverse  │   │
│ │ Нет пробития    │ Любое            │ No Sweep         │   │
│ └─────────────────┴──────────────────┴──────────────────┘   │
└─────────────────────────────────────────────────────────────┘
│
▼
┌─────────────────────────────────────────────────────────────┐
│ 🔄 ЭТАП 8: ПРОВЕРКА REBALANCE                              │
├─────────────────────────────────────────────────────────────┤
│ Условия для Rebalance:                                      │
│ 1. sweep_type == "Sweep and Reverse"                        │
│ 2. Цена коснулась Asia Mid (±3 пункта)                     │
│ 3. После касания продолжила движение против основного       │
│                                                             │
│ Результат: "Yes" или "No"                                   │
└─────────────────────────────────────────────────────────────┘
│
▼
┌─────────────────────────────────────────────────────────────┐
│ 📏 ЭТАП 9: РАСЧЕТ РАСШИРЕНИЙ                               │
├─────────────────────────────────────────────────────────────┤
│ От sweep_price до максимума/минимума после пробития:        │
│                                                             │
│ • extension_pips = расширение в пунктах                     │
│ • extension_percent = расширение в % от Asia Range          │
│ • reverse_pips = откат в противоположную сторону            │
│ • reverse_percent = откат в % от Asia Range                 │
│                                                             │
│ Время достижения максимума/минимума                         │
└─────────────────────────────────────────────────────────────┘
│
▼
┌─────────────────────────────────────────────────────────────┐
│ 🇺🇸 ЭТАП 10: АНАЛИЗ НЬЮ-ЙОРКА (15:00-19:00)              │
├─────────────────────────────────────────────────────────────┤
│ • NY Open = первая цена в 15:00                             │
│ • NY High/Low = максимум/минимум за 15:00-19:00             │
│                                                             │
│ NY Direction:                                               │
│ • up_move = NY High - NY Open                               │
│ • down_move = NY Open - NY Low                              │
│ • Результат: up_move > down_move ? "Long" : "Short"         │
│                                                             │
│ NY Status относительно Лондона:                             │
│ • Одинаковые направления = "Support"                        │
│ • Разные направления = "Reverse"                            │
└─────────────────────────────────────────────────────────────┘
│
▼
┌─────────────────────────────────────────────────────────────┐
│ 📊 ЭТАП 11: ДОПОЛНИТЕЛЬНЫЕ ПРОВЕРКИ                        │
├─────────────────────────────────────────────────────────────┤
│ • PDH/PDL Sweep: пробитие максимума/минимума прошлого дня   │
│ • Retest Sweep Level: возврат к уровню пробития             │
│ • Asia Mid Retest: касание средней линии Азии               │
│ • Временные метки всех ключевых событий                     │
└─────────────────────────────────────────────────────────────┘
│
▼
┌─────────────────────────────────────────────────────────────┐
│ 💾 ЭТАП 12: ФОРМИРОВАНИЕ РЕЗУЛЬТАТА                        │
├─────────────────────────────────────────────────────────────┤
│ Создание словаря с 40+ метриками:                           │
│                                                             │
│ {                                                           │
│   'date': '2024-01-15',                                     │
│   'day_of_week': 'Monday',                                  │
│   'asia_high': 1.10650,                                     │
│   'asia_low': 1.10450,                                      │
│   'asia_mid': 1.10550,                                      │
│   'frankfurt_sweep_high': 'No',                             │
│   'london_sweep_high': 'Yes',                               │
│   'sweep_type': 'Continue',                                 │
│   'london_direction': 'Long',                               │
│   'extension_pips': 25.5,                                   │
│   'ny_direction': 'Short',                                  │
│   'ny_status': 'Reverse',                                   │
│   ... (еще 30+ полей)                                      │
│ }                                                           │
└─────────────────────────────────────────────────────────────┘
│
▼
📊 ИТОГОВЫЙ РЕЗУЛЬТАТ
│
├── Один торговый день → Один словарь с метриками
├── Все дни в файле → DataFrame (таблица)
├── Сохранение в Excel → Листы: Analysis_Results, Statistics
└── Массовая обработка → Отдельный файл для каждого года

═══════════════════════════════════════════════════════════════

📈 ПРИМЕР ОБРАБОТКИ ОДНОГО ДНЯ:

ВХОДНЫЕ ДАННЫЕ:
2024-01-15 02:00 → 2024-01-15 19:00 (480 минутных свечей)

ЭТАПЫ ОБРАБОТКИ:
1. Asia (02:00-10:00): High=1.1065, Low=1.1045, Mid=1.1055
2. Frankfurt (09:00-10:00): Нет пробития
3. London (10:00-15:00): Пробитие Asia High в 11:30
4. Направление: Long (больше движения вверх)
5. Sweep Type: Continue (пробили вверх и продолжили вверх)
6. Расширение: 23 пункта вверх от места пробития
7. NY (15:00-19:00): Direction=Short, Status=Reverse

РЕЗУЛЬТАТ:
{
  'date': '2024-01-15',
  'london_sweep_high': 'Yes',
  'sweep_type': 'Continue',
  'extension_pips': 23.0,
  'ny_status': 'Reverse',
  ... (35+ других метрик)
}

═══════════════════════════════════════════════════════════════

🚀 МАССОВАЯ ОБРАБОТКА:

files/DAT_MT_EURUSD_M1_2014.csv (500,000 строк)
→ 260 дней анализа
→ results/analysis_EURUSD_2014_timestamp.xlsx

files/DAT_MT_EURUSD_M1_2015.csv (520,000 строк)
→ 261 день анализа
→ results/analysis_EURUSD_2015_timestamp.xlsx

... (16 файлов за 2014-2025 года)

ИТОГО: 4,000+ торговых дней, миллионы M1 свечей
→ Детальная статистика поведения EUR/USD по сессиям!
```

---

_Схема показывает полный цикл превращения сырых данных в готовую аналитику! 🔄_
